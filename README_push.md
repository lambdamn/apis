# Кассын утасгүй холболт

[TOC]

## 1. Танилцуулга

**Кассын утасгүй холболт** нь `Касс`-ын системийг `Голомт пос`-той утасгүй холболт хийх зориулалттай бөгөөд
тус гарын авлага нь уг холболтыг хэрхэн хийх талаар зааварчилгааг агуулсан болно.

## 1.1. Sequence Diagram

```seq
Client->Golomt POS: Гүйлгээний хүсэлт
Note right of Golomt POS: Төлбөр төлөлт\nхийгдэнэ
Golomt POS->Client: Гүйлгээний хүсэлтийн\nхариу
```

[==============]

## 1.2. Хүсэлт илгээх

Холболтонд өгсөн `TOKEN` утгыг Request Header-т дараах байдлаар дамжуулна

```
Authorization: Bearer ${TOKEN}
```

API сервис тус бүрийн хаяг рүү хүсэлт илгээх ба `BASE_URL` болон `TOKEN` мэдээллийг холболт хийх үед олгоно

```
${BASE_URL}\${SERVICE_URI} хаяг руу хүсэлт илгээнэ
```

[==============]

### 1.2.1. Хүсэлтийн хариу

Хүсэлтийн хариуд ирж байгаа утга нь `json` форматтай байх ба дараах бүтэцтэй байна. Нэмэлт талбаруудын талаар харгалзах сервисүүдийн хэсгээс танилцана уу

| Attribute | Төрөл   | Тайлбар                                        | Заавал |
| --------: | ------- | :--------------------------------------------- | ------ |
| `succeed` | boolean | Хүсэлт амжилттай болсон эсэх                   | Тийм   |
| `message` | string  | Хүсэлт амжилтгүй үед алдааг илэрхийлэх тайлбар | Үгүй   |

[==============]

## 1.3. Хүсэлт цуцлах

```
${BASE_URL}\payment\cancel хаяг руу POST хүсэлт илгээнэ
```

Өмнө илгээсэн хүсэлтийг цуцлах үед ашиглана.

[==============]

### 1.3.1. Хүсэлт цуцлахад шаардлагатай параметрүүд

Хүсэлтийн body хэсэгт `json` форматтай илгээх ба дараах бүтэцтэй байна.

| Attribute | Төрөл  | Тайлбар                 | Заавал |
| --------: | ------ | :---------------------- | ------ |
|   `posId` | string | Пос төхөөрөмжийн дугаар | Тийм   |

[==============]

### 1.3.2. Хүсэлт цуцлах хүсэлтийн хариу

Хүсэлтийн хариуд ирж байгаа Response body утга нь `json` форматтай байх ба дараах бүтэцтэй байна.

| Attribute | Төрөл   | Тайлбар                                        | Заавал |
| --------: | ------- | :--------------------------------------------- | ------ |
| `succeed` | boolean | Хүсэлт амжилттай болсон эсэх                   | Тийм   |
| `message` | string  | Хүсэлт амжилтгүй үед алдааг илэрхийлэх тайлбар | Үгүй   |

[==============]

## 1.4. Холболт шалгах

```
${BASE_URL}\payment\logon хаяг руу POST хүсэлт илгээнэ
```

Энэ үйлдлийг хийснээр `Pos` төхөөрөмж банктай холбогдон сүлжээний холболт хэвийн байгаа эсэх мөн гүйлгээ хийх key-гээ шинэчилдэг.
Тухайн өдрийн гүйлгээний эхэнд нэг удаа дуудвал тохиромжтой.

[==============]

### 1.4.1. Холболт шалгахад шаардлагатай параметрүүд

Хүсэлтийн body хэсэгт `json` форматтай илгээх ба дараах бүтэцтэй байна.

| Attribute | Төрөл  | Тайлбар                 | Заавал |
| --------: | ------ | :---------------------- | ------ |
|   `posId` | string | Пос төхөөрөмжийн дугаар | Тийм   |

[==============]

### 1.4.1. Холболт шалгахад хүсэлтийн хариу

Хүсэлтийн хариуд ирж байгаа Response body утга нь `json` форматтай байх ба дараах бүтэцтэй байна.

| Attribute | Төрөл   | Тайлбар                                        | Заавал |
| --------: | ------- | :--------------------------------------------- | ------ |
| `succeed` | boolean | Хүсэлт амжилттай болсон эсэх                   | Тийм   |
| `message` | string  | Хүсэлт амжилтгүй үед алдааг илэрхийлэх тайлбар | Үгүй   |

[==============]

## 1.5. Гүйлгээ хийх

```
${BASE_URL}\payment\purchase хаяг руу POST хүсэлт илгээнэ
```

Худалдан авалт буюу гүйлгээ хийх үед ашиглана.

[==============]

### 1.5.1. Гүйлгээ хийхэд шаардлагатай параметрүүд

Хүсэлтийн body хэсэгт `json` форматтай илгээх ба дараах бүтэцтэй байна.

| Параметр       | Төрөл  | Тайлбар                            |
| -------------- | ------ | ---------------------------------- | ---- |
| `amount`       | double | Гүйлгээ хийх дүн                   | Тийм |
| `referralcode` | string | Дахин давтагдахгүй утга байна      | Тийм |
| `posId`        | string | Пос төхөөрөмжийн дугаар            | Тийм |
| `skipPrint`    | bool   | Баримт хэвлэх эсэх                 | Үгүй |
| `payment`      | int    | Төлбөрийн хэрэгслийг сонгож илгээх | Үгүй |

[==============]

### 1.5.2. Төлбөрийн хэрэгслийн утга

| Утга | Төрөл          | Тайлбар                                            |
| ---- | -------------- | -------------------------------------------------- |
| 1    | Карт           | Зөвхөн картын гүйлгээ хийх үед                     |
| 4    | SocialPay - QR | Зөвхөн SocialPay - QR код ашиглан гүйлгээ хийх үед |
| 7    | Monpay - QR    | Зөвхөн Monpay - QR код ашиглан гүйлгээ хийх үед    |

[==============]

### 1.5.3. Гүйлгээний хүсэлтийн хариу

Гүйлгээний хүсэлтийн хариуд ирж байгаа Response body утга нь `json` форматтай байх ба дараах бүтэцтэй байна.

|       Attribute | Төрөл   | Тайлбар                                        | Заавал |
| --------------: | ------- | :--------------------------------------------- | ------ |
|       `succeed` | boolean | Хүсэлт амжилттай болсон эсэх                   | Тийм   |
|       `message` | string  | Хүсэлт амжилтгүй үед алдааг илэрхийлэх тайлбар | Үгүй   |
|        `amount` | double  | Гүйлгээ хийсэн дүн                             | Үгүй   |
|       `payment` | string  | Гүйлгээ хийгдсэн төлбөрийн хэрэгсэл            | Үгүй   |
|     `systemRef` | string  | Гүйлгээний ref дугаар                          | Үгүй   |
|       `traceno` | string  | Гүйлгээний trace дугаар                        | Үгүй   |
|   `approveCode` | string  | Зөвшөөрлийн код                                | Үгүй   |
|     `maskedPAN` | string  | Картын маскалсан дугаар                        | Үгүй   |
| `transactionAt` | string  | Гүйлгээ хийгдсэн огноо                         | Үгүй   |
|    `merchantId` | string  | Мерчант дугаар                                 | Үгүй   |
|    `terminalId` | string  | Терминал дугаар                                | Үгүй   |

## 1.6. Буцаалт хийх

```
${BASE_URL}\payment\void хаяг руу POST хүсэлт илгээнэ
```

Худалдан авалт буцаах үед гүйлгээ буцаалт хийх үед ашиглана.

[==============]

### 1.6.1. Буцаалт хийхэд шаардлагатай параметрүүд

Хүсэлтийн body хэсэгт `json` форматтай илгээх ба дараах бүтэцтэй байна.

| Параметр    | Төрөл  | Тайлбар                 |
| ----------- | ------ | ----------------------- | ---- |
| `traceno`   | string | Гүйлгээний trace дугаар | Тийм |
| `skipPrint` | bool   | Баримт хэвлэх эсэх      | Үгүй |
| `posId`     | string | Пос төхөөрөмжийн дугаар | Тийм |

[==============]

### 1.6.2. Буцаалтын хүсэлтийн хариу

Буцаалтын хүсэлтийн хариуд ирж байгаа Response body утга нь `json` форматтай байх ба дараах бүтэцтэй байна.

|       Attribute | Төрөл   | Тайлбар                                        | Заавал |
| --------------: | ------- | :--------------------------------------------- | ------ |
|       `succeed` | boolean | Хүсэлт амжилттай болсон эсэх                   | Тийм   |
|       `message` | string  | Хүсэлт амжилтгүй үед алдааг илэрхийлэх тайлбар | Үгүй   |
|        `amount` | double  | Буцаалтын гүйлгээний дүн                       | Үгүй   |
|       `payment` | string  | Төлбөрийн хэрэгсэл                             | Үгүй   |
|     `systemRef` | string  | Буцаалтын гүйлгээний ref дугаар                | Үгүй   |
|       `traceno` | string  | Буцаалтын гүйлгээний trace дугаар              | Үгүй   |
|   `origTraceno` | string  | Гүйлгээний trace дугаар                        | Үгүй   |
|   `approveCode` | string  | Зөвшөөрлийн код                                | Үгүй   |
|     `maskedPAN` | string  | Картын маскалсан дугаар                        | Үгүй   |
| `transactionAt` | string  | Буцаалтын гүйлгээ хийгдсэн огноо               | Үгүй   |
|    `merchantId` | string  | Мерчант дугаар                                 | Үгүй   |
|    `terminalId` | string  | Терминал дугаар                                | Үгүй   |

## 1.7. Гүйлгээ лавлах

```
${BASE_URL}\payment\inquiry хаяг руу POST хүсэлт илгээнэ
```

Сүлжээний доголдлын болон бусад шалтгааны улмаас гүйлгээний хариу ирээгүй тохиолдолд гүйлгээ амжилттай хийгдсэн эсэхийг лавлаж ашиглана.

[==============]

### 1.7.1. Гүйлгээ лавлахад шаардлагатай параметрүүд

| Параметр       | Төрөл  | Тайлбар                                |
| -------------- | ------ | -------------------------------------- | ---- |
| `referralcode` | string | Гүйлгээ хийх үед дамжуулсан утга байна | Тийм |
| `posId`        | string | Пос төхөөрөмжийн дугаар                | Тийм |

[==============]

### 1.7.2. Гүйлгээ лавлах хүсэлтийн хариу

Буцаалтын хүсэлтийн хариуд ирж байгаа Response body утга нь `json` форматтай байх ба дараах бүтэцтэй байна.

|       Attribute | Төрөл   | Тайлбар                                        | Заавал |
| --------------: | ------- | :--------------------------------------------- | ------ |
|       `succeed` | boolean | Хүсэлт амжилттай болсон эсэх                   | Тийм   |
|       `message` | string  | Хүсэлт амжилтгүй үед алдааг илэрхийлэх тайлбар | Үгүй   |
|        `amount` | double  | Гүйлгээ хийсэн дүн                             | Үгүй   |
|       `payment` | string  | Гүйлгээ хийгдсэн төлбөрийн хэрэгсэл            | Үгүй   |
|     `systemRef` | string  | Гүйлгээний ref дугаар                          | Үгүй   |
|       `traceno` | string  | Гүйлгээний trace дугаар                        | Үгүй   |
|   `approveCode` | string  | Зөвшөөрлийн код                                | Үгүй   |
|     `maskedPAN` | string  | Картын маскалсан дугаар                        | Үгүй   |
| `transactionAt` | string  | Гүйлгээ хийгдсэн огноо                         | Үгүй   |
|    `merchantId` | string  | Мерчант дугаар                                 | Үгүй   |
|    `terminalId` | string  | Терминал дугаар                                | Үгүй   |

[==============]
